<!-- SINGLE-FILE-COMPONENT -->
<!-- https://framework7.io/docs/router-component.html#single-file-component -->

<template>
    <div class="page" data-name="view-tree">

        <!-- Scrollable PAGE CONTENT-->
        <div class="page-content">

            <div id='container'>
                <div id="group1">

                    <div class="background">
                        <div class="favorite">
                            <!-- custom-favorite element will go here -->
                        </div>
                        <img id="img-tree" src="{{tree.img_url}}">
                    </div>

                    <div class="elevation-4 bottom-border">
                        <div class="foreground user-reaction bottom-border top-border">

                            <img src="img/pin-flower-shadow.png" alt="Pin Flower" class="pin-flower">
                            
                            <!-- BLOOM -->
                            <div class="field input-section">
                                <div id="title-bloom" class="section-title">BLOOM</div>
                                <div class="bloom">
                                    <!-- custom-bloom element will go here -->
                                </div>
                            </div>

                            <div class="hr-wrapper">
                                <img class="hr" src="img/hr.png" alt="hr">
                            </div>
                            
                            <!-- RATING -->
                            <div class="field input-section">
                                <div class="section-title">RATING</div>
                                <div class="rating">
                                    <!-- custom-rating element will go here -->
                                </div>
                            </div>

                            <div class="hr-wrapper">
                                <img class="hr" src="img/hr.png" alt="hr">
                            </div>

                            <!-- STATUS -->
                            <!-- <div class="field input-section">
                                <div class="section-title">STATUS</div>
                                <div class="status-flex-box">
                                    <div data-bloom="1" class="elevation-4">Blossoming</div>
                                    <div data-bloom="2" class="elevation-4">Growing</div>
                                    <div data-bloom="3" class="elevation-4">Blooming</div>
                                </div>
                            </div>

                            <div class="hr-wrapper">
                                <img class="hr" src="img/hr.png" alt="hr">
                            </div> -->


                            <!-- LOCATION -->
                            <div class="field input-section">
                                <!-- <div class="section-title">LOCATION</div> -->
                                <div class="flex-box hidden">
                                    <span>Latitude: <span id="lat">{{tree.lat}}</span></span>
                                    <span>Longitude: <span id="lng">{{tree.lng}}</span></span>
                                </div>

                                <div class="tree-address-container">
                                    <img id="ic_tree_address" src="img/ic_tree_address.png" alt="">
                                    <span id="tree-address">{{tree.address}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

</template>
<!-- component styles -->
<style>

    .user-reaction {
        padding: 1rem;
        background: #fff;

        /* TODO - remove this */
        padding-bottom: 2rem;
    }


    /* Spacing between each row: */
    .field {
        /* margin-bottom: 3rem; */
    }

    /* centering radio buttons: */
    .field .radio i {
        margin:auto;
    }

    .flex-box {
        display: flex;
        justify-content: space-between
    }

    @media screen and (min-width:900px) {
        .foreground {
            top: 80vh;
        }

        .background img {
            max-height:80vh;
        }
    }

</style>
<!-- rest of component data and methods -->
<script>
    // script must return component object
    return {

        data: function () {
            return {

                //This tree object will be filled after the firebase request:
                tree: new Tree(),
                favorite: false,

                checkRating: function(v){

                    return (v == this.tree.rating) ? "checked" : ""
                }
            }
        },

        on: {
            pageInit: function () {
                // do something on page init
                var self = this;
                console.log('view-tree initialized');




                //Getting the ID for the tree from the router.
                var id = mainView.router.currentRoute.context.key;


                treeCRUD.read(id, function(result) {
                    self.tree = result;    //Updating tree object
                    self.$setState();      //Forcing the view to reset

                    //Setting the value to the slider:
                    // app.range.get('.range-slider').setValue(self.tree.blooming);

                    // app.range.get('.range-slider').params.draggableBar = false;
                    // $(".status-flex-box div[data-bloom=" + self.tree.blooming + "]").addClass("status-selected")


                    $(".rating").load("custom/rating/custom-rating.html", function() {
                        $('custom-rating').val(self.tree.rating);

                        $('custom-rating').prop('enabled', false);
                    });

                    $(".bloom").load("custom/bloom/custom-bloom.html", function() {
                        $('custom-bloom').val(self.tree.blooming);

                        $('custom-bloom').prop('enabled', false);
                    });

                    $(".favorite").load("custom/favorite/custom-favorite.html", function() {
                        $('custom-favorite').val(0);

                        $('custom-favorite').on('heart', () => {
                            console.log("new value..");
                            //new value assigned:
                            self.favorite = parseInt($('custom-favorite').val());
                            console.log("...done!");
                        });
                    });


                });

            },
            pageAfterOut: function () {
                // page has left the view
            },
        }
    }
</script>
