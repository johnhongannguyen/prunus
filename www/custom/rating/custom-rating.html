<!-- USAGE: Add a div to contain the rating bar: -->
<!-- <div class="rating"> -->
<!-- </div> -->

<!-- THEN ON JS: Load the component and listen to value changes -->

<!-- $(".rating").load("../custom/rating/custom-rating.html", function() {

    $('custom-rating').on('rate', () => {

        //new value assigned:
        let newVal = $('custom-rating').val();
        console.log(newVal);

    });

}); -->

<custom-rating>
</custom-rating>

<style>
    custom-rating {
        display:flex;
    }

    custom-rating > .star {
        width:50px;
        height:50px;

        /* Path is actually from the page that is calling... */
        background-image: url('../custom/rating/ic_rating_empty.png');
        background-size: cover;
    }

    custom-rating > .star.full {
        width:50px;
        height:50px;

        /* Path is actually from the page that is calling... */
        background-image: url('../custom/rating/ic_rating_full.png');
        background-size: cover;
    }
</style>

<script>
    class CustomRating extends HTMLElement{

        get value (){
            return this.getAttribute('value') || 0;
        }

        set value (val) {
            this.setAttribute('value', val);
            this.select(this.value - 1);
        }

        constructor(){
            super();

            this.stars = [];

            for (var i = 0; i < 5; i++) {
                let s = document.createElement('div');
                s.className = 'star';
                this.appendChild(s);
                this.stars.push(s);
            }

            //This has to be after the loop...
            this.value = this.value;

            this.addEventListener('click', function(e) {


                //Get current child:
                e = e || window.event;
                var currentChild = e.target || e.srcElement, text = currentChild.textContent || currentChild.innerText;

                //get current position:
                var pos = 0;
                while( (currentChild = currentChild.previousSibling) != null ){
                    pos++;
                }

                this.value = pos;

                //Every time the user clicks in a star, dispatch this event.
                let rateEvent = new Event('rate');
                this.dispatchEvent(rateEvent);

            }, false);

        }

        select(index){
            this.stars.forEach((star,i) => {
                star.classList.toggle('full', i <= index );
            });
        }
    }

    //This makes the DOM recognize the custom HTML element:
    window.customElements.define('custom-rating', CustomRating);

</script>
