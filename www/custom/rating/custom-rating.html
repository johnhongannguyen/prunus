<!-- USAGE: Add a div to contain the rating bar: -->
<!-- <div class="rating"> -->
<!-- </div> -->

<!-- THEN ON JS: Load the component and listen to value changes -->

<!-- $(".rating").load("custom/rating/custom-rating.html", function() {

$('custom-rating').on('rate', () => {

//new value assigned:
let newVal = $('custom-rating').val();
console.log(newVal);

});

}); -->

<!-- To disable: -->
<!-- $('custom-rating').prop('enabled', false); -->

<custom-rating>
</custom-rating>

<style>
    custom-rating {
        display:flex;
        align-items: center;
        height:60px;
    }

    .rating {
        margin-bottom: 0;
    }

    /* Basic style for all emotions */
    custom-rating > .wrapper > .star {
        margin-left: 3px;
        margin-right: 3px;
        width:45px;
        height:45px;
        /* transition: height .5s, width .5s; */
        position: relative;
        z-index: initial;
        background-size: cover;
    }

    /* Overwrite dimensions for the selected emotion */
    custom-rating > .wrapper > .star.full > .bubbles {
        /* width:55px;
        height:55px; */
        /* transition: height .5s, width .5s; */
        animation: bounceIn 1s linear 1;
    }

    .wrapper {
        z-index: 10;
        position: relative;
    }

    .bubbles {
        position: relative;
        width:45px;
        height:45px;
        background-image: url('custom/rating/ic_load_bubbles.png');
        background-size: cover;
        z-index: -1;
        opacity: 0;
    }

    /* Enabled and Disabled styles for every emotion */
    /* Path is actually from the page that is calling... */
    custom-rating > .wrapper > .star.em1 {
        background-image: url('custom/rating/emotion-1-disabled.png');
    }

    custom-rating > .wrapper > .star.em1.full {
        background-image: url('custom/rating/emotion-1-en.png');
    }

    custom-rating > .wrapper > .star.em2 {
        background-image: url('custom/rating/emotion-2-disabled.png');
    }

    custom-rating > .wrapper > .star.em2.full {
        background-image: url('custom/rating/emotion-2-en.png');
    }

    custom-rating > .wrapper > .star.em3 {
        background-image: url('custom/rating/emotion-3-disabled.png');
    }

    custom-rating > .wrapper > .star.em3.full {
        background-image: url('custom/rating/emotion-3-en.png');
    }

    custom-rating > .wrapper > .star.em4 {
        background-image: url('custom/rating/emotion-4-disabled.png');
    }

    custom-rating > .wrapper > .star.em4.full {
        background-image: url('custom/rating/emotion-4-en.png');
    }

    custom-rating > .wrapper > .star.em5 {
        background-image: url('custom/rating/emotion-5-disabled.png');
    }

    custom-rating > .wrapper > .star.em5.full {
        background-image: url('custom/rating/emotion-5-en.png');
    }

    @keyframes bounceIn {
        0% {
            opacity: 1;
            transform: scale3d(0.3, 0.3, 0.3);
        }
        
        30% {
            opacity: 0.8;
            transform: scale3d(0.8, 0.8, 0.8);
        }

        65% {
            
            transform: scale3d(1.1, 1.1, 1.1);
        }

        70% {
            opacity: 0;
            transform: scale3d(1.25, 1.25, 1.25);
        }

        100% {
            opacity: 0;
            transform: scale3d(1.3, 1.3, 1.3);
        }
    }
</style>

<script>
    class CustomRating extends HTMLElement{

        get value () {
            return this.getAttribute('value') || 0;
        }

        set value (val) {
            this.setAttribute('value', val);
            this.select(this.value - 1);
        }

        get enabled () {
            return this.getAttribute('enabled') || true;
        }

        set enabled (val) {
            this.setAttribute('enabled', val);
        }

        constructor(){
            super();

            this.stars = [];

            for (var i = 0; i < 5; i++) {
                let wrapper = document.createElement('div');
                wrapper.className = 'wrapper';

                let bg = document.createElement('div');
                bg.className = 'bubbles';
                
                let s = document.createElement('div');
                s.className = 'star em'+(i+1);
                s.appendChild(bg)
                wrapper.appendChild(s)

                this.appendChild(wrapper);
                this.stars.push(s);
            }

            //This has to be after the loop...
            this.value = this.value;
            this.enabled = this.enabled;

            this.addEventListener('click', this.getClickFunction, false);
        }

        select(index){
            this.stars.forEach((star,i) => {
                star.classList.toggle('full', i == index );
            });
        }

        getClickFunction(e) {

                if(this.enabled + '' === 'true'){

                    //Get current child:
                    e = e || window.event;
                    var currentChild = e.target || e.srcElement, text = currentChild.textContent || currentChild.innerText;
                    // console.log(currentChild.className)
                    //get current position:
                    var pos = 0;
                    currentChild = currentChild.parentElement
                    while( (currentChild = currentChild.previousSibling) != null ){
                        pos++;
                    }

                    this.value = pos;

                    //Every time the user clicks in a star, dispatch this event.
                    let rateEvent = new Event('rate');
                    this.dispatchEvent(rateEvent);
                }
        }

    }

    //This makes the DOM recognize the custom HTML element:
    if(!window.customElements.get('custom-rating')){
        window.customElements.define('custom-rating', CustomRating);
    }


</script>
